<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CETæ¶ˆæ¶ˆä¹'</title>
<style>
  :root{
    --accent: #ffd166;
    --glass: rgba(255,255,255,0.06);
    --card: #ffffff;
    --muted: rgba(255,255,255,0.85);
    --bg1: rgba(20,24,82,0.95);
  }
  html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Helvetica Neue",Arial;}
  body{
    background:
      linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)),
      radial-gradient(800px 400px at 10% 10%, rgba(99,102,241,0.12), transparent 20%),
      radial-gradient(900px 500px at 90% 90%, rgba(14,165,233,0.08), transparent 18%),
      linear-gradient(160deg, #0b1226, #29124a);
    -webkit-font-smoothing:antialiased;color:var(--muted);
    display:flex;align-items:center;justify-content:center;padding:20px;
  }

  /* App container */
  .app {
    width:100%;
    max-width:760px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:18px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    padding:18px;
    box-sizing:border-box;
    color:var(--muted);
  }

  /* Header */
  header {
    text-align:center;
    margin-bottom:14px;
  }
  header h1 {
    margin:6px 0;
    color:var(--accent);
    font-size:34px;
    letter-spacing:1px;
  }
  header p { margin:0;font-size:13px;opacity:0.9 }

  /* Layout: two columns on large screens */
  .layout{
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:18px;
  }
  @media (max-width:820px){
    .layout{grid-template-columns:1fr;}
  }

  /* Left: Home / Mode selection (vertical) */
  .left {
    display:flex;
    flex-direction:column;
    gap:12px;
    align-items:center;
  }

  .mode-card {
    width:100%;
    background:var(--glass);
    border-radius:12px;
    padding:14px;
    text-align:center;
    cursor:pointer;
    transition:transform .18s, box-shadow .18s;
    border:1px solid rgba(255,255,255,0.03);
  }
  .mode-card:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(0,0,0,0.45) }

  .mode-title { font-size:18px;color:var(--accent); font-weight:700 }
  .mode-desc { font-size:13px; opacity:0.95; margin-top:6px }

  /* Library selector and small controls */
  .lib-select { display:flex; gap:8px; justify-content:center; margin-bottom:8px;}
  .lib-btn {
    padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer;
    border:1px solid rgba(255,255,255,0.04)
  }
  .lib-btn.active{ background:var(--accent); color:#0b1226; font-weight:700 }

  /* Right: Game area */
  .right {
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .panel {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:14px;
    min-height:320px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  }

  .controls {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    margin-bottom:10px;
  }

  .btn {
    padding:10px 12px;
    border-radius:10px;
    border:0;
    cursor:pointer;
    font-weight:700;
  }
  .btn.primary { background:var(--accent); color:#081823 }
  .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted) }

  .status { font-size:14px; }

  /* Board */
  .board {
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:12px;
  }
  @media (max-width:640px){
    .board{ grid-template-columns: repeat(2, 1fr); }
  }

  .card {
    background: var(--card);
    color: #082028;
    border-radius:12px;
    padding:12px;
    text-align:center;
    font-weight:700;
    cursor:pointer;
    user-select:none;
    box-shadow: 0 8px 20px rgba(2,6,23,0.12);
    transition: transform .12s, opacity .25s;
  }
  .card.active{ transform: scale(1.04); box-shadow:0 18px 36px rgba(0,0,0,0.25) }
  .card.hidden{ opacity:0; transform: scale(.6); pointer-events:none }

  .footer { text-align:center; margin-top:10px; font-size:13px; opacity:0.85 }

  .small { font-size:12px; opacity:0.85; color:rgba(255,255,255,0.9) }

  /* nice hint / toast */
  .toast {
    position:fixed; left:50%; transform:translateX(-50%); bottom:28px;
    background:rgba(0,0,0,0.7); color:#fff; padding:8px 12px; border-radius:10px; display:none;
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="CETæ¶ˆæ¶ˆä¹ åº”ç”¨">

    <header>
      <h1>CETæ¶ˆæ¶ˆä¹'</h1>
      <p>å…³å¡é—¯å…³ Â· æ²‰æµ¸/è¿æˆ˜/å¤ä»‡ Â· åˆ†äº«é‚€è¯· Â· é”™è¯å¤ä¹ </p>
    </header>

    <div class="layout">

      <!-- LEFT: Mode selection + library toggles -->
      <section class="left" aria-label="æ¨¡å¼é€‰æ‹©åŒº">
        <div class="lib-select" role="tablist" aria-label="è¯åº“é€‰æ‹©">
          <button id="btnCET4" class="lib-btn active" onclick="switchLib('cet4')">CET-4</button>
          <button id="btnCET6" class="lib-btn" onclick="switchLib('cet6')">CET-6</button>
        </div>

        <div class="mode-card" onclick="chooseMode('immerse')">
          <div class="mode-title">ğŸ§˜â€â™‚ï¸ æ²‰æµ¸å±€</div>
          <div class="mode-desc">æ”¾æ¾ç»ƒä¹ ï¼Œé€ä¸ªè®¤è¯†è¯ä¹‰ä¸æ­é…ï¼ˆè½»æ¾æ¨¡å¼ï¼‰</div>
        </div>

        <div class="mode-card" onclick="chooseMode('battle')">
          <div class="mode-title">âš”ï¸ è¿æˆ˜å±€</div>
          <div class="mode-desc">è®¡åˆ†æŒ‘æˆ˜å¹¶è®°å½•é”™è¯ï¼Œå¯é‚€è¯·åŒå­¦æ¥æŒ‘æˆ˜ï¼ˆç«èµ›æ¨¡å¼ï¼‰</div>
        </div>

        <div class="mode-card" onclick="chooseMode('revenge')">
          <div class="mode-title">ğŸ”¥ å¤ä»‡å±€</div>
          <div class="mode-desc">ä¸“æ”»é”™è¯æœ¬ï¼šåªç”¨ä½ ä¹‹å‰é”™è¿‡çš„è¯æ¥å¤ä¹ ï¼ˆå¼ºåŒ–æ¨¡å¼ï¼‰</div>
        </div>

        <div style="width:100%;margin-top:8px;text-align:center">
          <button class="btn ghost" onclick="openWrongBook()">æŸ¥çœ‹é”™è¯æœ¬</button>
        </div>
      </section>

      <!-- RIGHT: Game area -->
      <section class="right">
        <div class="panel">

          <div class="controls">
            <div>
              <span class="small">æ¨¡å¼ï¼š</span>
              <strong id="modeLabel">â€”</strong>
              <span style="margin-left:12px" class="small">å…³å¡ï¼š</span>
              <select id="levelSelect" onchange="changeLevel()" aria-label="å…³å¡é€‰æ‹©"></select>
            </div>

            <div style="display:flex;gap:8px;align-items:center">
              <button id="shareBtn" class="btn ghost" onclick="shareInvite()">ğŸ“¤ é‚€è¯·/åˆ†äº«</button>
              <button id="startBtn" class="btn primary" onclick="startLevel()">å¼€å§‹</button>
            </div>
          </div>

          <div class="controls" style="margin-top:6px">
            <div class="status">å¾—åˆ†ï¼š<strong id="score">0</strong></div>
            <div class="status">å‰©ä½™å¡ï¼š<strong id="left">0</strong></div>
          </div>

          <div id="board" class="board" aria-live="polite"></div>

        </div>

        <div class="footer">
          æç¤ºï¼šç‚¹å‡»è‹±æ–‡ / ä¸­æ–‡å¡ç‰‡é…å¯¹æ¶ˆé™¤ã€‚é€šå…³è‡ªåŠ¨è§£é”ä¸‹ä¸€å…³ã€‚é”™è¯ä¼šè¢«è®°å½•åˆ°é”™è¯æœ¬ã€‚
        </div>
      </section>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>
  </div>

<script>
/*
  æœ€ç»ˆç‰ˆæ¸¸æˆä¸»è„šæœ¬
  è¯´æ˜ï¼š
  - éœ€è¦ä¸¤ä¸ªå¤–éƒ¨æ–‡ä»¶ï¼ˆå·²ç”Ÿæˆæˆ–ä¸Šä¼ ï¼‰:
      CET4_levels.js  (å®šä¹‰ window.CET4_LEVELS = {...})
      CET6_levels.js  (å®šä¹‰ window.CET6_LEVELS = {...})
    å¦‚æœä½ å°šæœªä¸Šä¼ ï¼Œè¯·å…ˆåˆ›å»ºå¹¶ç²˜è´´å¯¹åº”å†…å®¹ï¼ˆä¹‹å‰æˆ‘å·²å¸®ä½ ç”Ÿæˆç¤ºä¾‹æ–‡ä»¶ï¼‰ã€‚
  - è¯·ç§»é™¤æˆ–å¿½ç•¥æ—§çš„ words_cet.jsï¼ˆä¸è¦å†åœ¨ index.html ä¸­å¼•ç”¨å®ƒï¼‰
*/

/* ---------- å…¼å®¹åŠ è½½ä¸å›é€€ï¼ˆè‹¥å¤–éƒ¨è¯åº“ç¼ºå¤±ï¼Œå°†ä½¿ç”¨å†…ç½®ç¤ºä¾‹ï¼‰ ---------- */
const FALLBACK_CET4 = {
  "level1":[{en:"book",cn:"ä¹¦"},{en:"study",cn:"å­¦ä¹ "},{en:"school",cn:"å­¦æ ¡"},{en:"teacher",cn:"è€å¸ˆ"}],
  "level2":[{en:"ability",cn:"èƒ½åŠ›"},{en:"accept",cn:"æ¥å—"},{en:"achieve",cn:"å®ç°"},{en:"active",cn:"ç§¯æçš„"}]
};
const FALLBACK_CET6 = {
  "level1":[{en:"abstract",cn:"æŠ½è±¡çš„"},{en:"advocate",cn:"æå€¡"},{en:"allocate",cn:"åˆ†é…"},{en:"analogy",cn:"ç±»æ¯”"}],
  "level2":[{en:"ambiguous",cn:"æ¨¡ç³Šçš„"},{en:"assumption",cn:"å‡è®¾"},{en:"diminish",cn:"å‡å°‘"},{en:"empirical",cn:"ç»éªŒçš„"}]
};

const CET4 = (window.CET4_LEVELS && typeof window.CET4_LEVELS === 'object') ? window.CET4_LEVELS : FALLBACK_CET4;
const CET6 = (window.CET6_LEVELS && typeof window.CET6_LEVELS === 'object') ? window.CET6_LEVELS : FALLBACK_CET6;

/* ---------- å…¨å±€çŠ¶æ€ ---------- */
let LIB_NAME = 'cet4'; // 'cet4' or 'cet6'
let LEVELS = (LIB_NAME === 'cet4') ? CET4 : CET6;
let LEVEL_KEYS = Object.keys(LEVELS); // ['level1','level2',...]
let currentLevelKey = LEVEL_KEYS[0] || 'level1';
let MODE = null; // 'immerse' | 'battle' | 'revenge'
let score = 0;
let selected = null; // { key, text, el }
let wrongBook = JSON.parse(localStorage.getItem('cet_wrong')||'[]'); // [{en,cn}]
let progress = JSON.parse(localStorage.getItem('cet_progress')||'{}'); // {cet4:{level1:true,...}, cet6:{...}}

/* ---------- DOM refs ---------- */
const btnCET4 = document.getElementById('btnCET4');
const btnCET6 = document.getElementById('btnCET6');
const modeLabel = document.getElementById('modeLabel');
const levelSelect = document.getElementById('levelSelect');
const scoreEl = document.getElementById('score');
const leftEl = document.getElementById('left');
const boardEl = document.getElementById('board');
const startBtn = document.getElementById('startBtn');
const shareBtn = document.getElementById('shareBtn');
const toastEl = document.getElementById('toast');

/* ---------- åˆå§‹åŒ– UI ---------- */
function init(){
  // load library selection UI
  renderLevelOptions();
  loadQueryParams(); // support invite links ?mode=battle&level=level2&lib=cet6
  updateModeLabel();
  updateLibButtons();
  updateProgressUI();
  showToast('å°±ç»ª â€” é€‰æ‹©æ¨¡å¼å¹¶å¼€å§‹é—¯å…³å§ï¼', 1200);
}
init();

/* ---------- Utility ---------- */
function showToast(msg, ms=1200){
  toastEl.innerText = msg;
  toastEl.style.display = 'block';
  setTimeout(()=>{ toastEl.style.display = 'none'; }, ms);
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}
function saveWrong(){ localStorage.setItem('cet_wrong', JSON.stringify(wrongBook)); }
function saveProgress(){ localStorage.setItem('cet_progress', JSON.stringify(progress)); }

/* ---------- Library switching (CET4 / CET6) ---------- */
function switchLib(lib){
  if(lib === LIB_NAME) return;
  LIB_NAME = lib;
  LEVELS = (LIB_NAME === 'cet4') ? CET4 : CET6;
  LEVEL_KEYS = Object.keys(LEVELS);
  currentLevelKey = LEVEL_KEYS[0] || 'level1';
  renderLevelOptions();
  updateLibButtons();
  updateProgressUI();
  showToast('è¯åº“å·²åˆ‡æ¢ä¸º ' + (LIB_NAME==='cet4'?'CET-4':'CET-6'), 800);
}
function updateLibButtons(){
  btnCET4.classList.toggle('active', LIB_NAME==='cet4');
  btnCET6.classList.toggle('active', LIB_NAME==='cet6');
}

/* ---------- Level select render ---------- */
function renderLevelOptions(){
  levelSelect.innerHTML = '';
  LEVEL_KEYS = Object.keys(LEVELS);
  LEVEL_KEYS.forEach(key=>{
    const opt = document.createElement('option');
    opt.value = key;
    opt.innerText = key.replace('level','ç¬¬') + ' å…³';
    levelSelect.appendChild(opt);
  });
  // try keep currentLevelKey if exists
  if(!LEVEL_KEYS.includes(currentLevelKey)) currentLevelKey = LEVEL_KEYS[0];
  levelSelect.value = currentLevelKey;
}

/* ---------- Mode selection (from left) ---------- */
function chooseMode(m){
  MODE = m;
  selected = null;
  score = 0; updateScore();
  updateModeLabel();
  // show hint: for revenge mode check wrongBook
  if(MODE === 'revenge' && (!wrongBook || wrongBook.length===0)){
    startBtn.disabled = true;
    startBtn.innerText = 'é”™é¢˜æœ¬ä¸ºç©º';
    showToast('é”™è¯æœ¬ä¸ºç©º â€” å…ˆç©è¿æˆ˜å±€æˆ–æ²‰æµ¸å±€åˆ¶é€ é”™è¯å§', 1600);
  } else {
    startBtn.disabled = false;
    startBtn.innerText = 'å¼€å§‹';
  }
  // set level select to chosen level if available
  renderLevelOptions();
  // scroll to right area (for small screen)
  document.getElementById('board').scrollIntoView({behavior:'smooth'});
}

/* ---------- update mode label ---------- */
function updateModeLabel(){
  const label = MODE === 'immerse' ? 'æ²‰æµ¸å±€' : MODE === 'battle' ? 'è¿æˆ˜å±€' : MODE === 'revenge' ? 'å¤ä»‡å±€' : 'â€”';
  modeLabel.innerText = label;
}

/* ---------- handle level select change ---------- */
function changeLevel(){
  currentLevelKey = levelSelect.value;
  selected = null;
  score = 0; updateScore();
}

/* ---------- start level ---------- */
function startLevel(){
  if(!MODE){
    showToast('è¯·å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªæ¨¡å¼ï¼ˆæ²‰æµ¸ / è¿æˆ˜ / å¤ä»‡ï¼‰', 1200);
    return;
  }

  // Choose word pool
  let pool = [];
  if(MODE === 'revenge'){
    pool = wrongBook.length ? wrongBook.map(w=>({en:w.en,cn:w.cn})) : [];
    if(pool.length === 0){ showToast('é”™è¯æœ¬ä¸ºç©º',1200); return; }
  } else {
    const levelWords = LEVELS[currentLevelKey] || [];
    pool = shuffle([...levelWords]);
  }

  // Determine number of pairs: base 3, increase with level index
  const levelIndex = Math.max(1, parseInt(currentLevelKey.replace('level','')) || 1);
  const pairs = Math.min(3 + Math.floor(levelIndex/1), 8); // cap 8 pairs
  const pick = pool.slice(0, Math.min(pairs, pool.length));

  // Build card list (each pair -> en and cn)
  const cards = [];
  pick.forEach(w=>{
    cards.push({text:w.en, key:w.en});
    cards.push({text:w.cn, key:w.en});
  });
  shuffle(cards);
  renderCards(cards);
  score = 0; updateScore();
  showToast('å¼€å§‹ç¬¬ ' + currentLevelKey.replace('level','') + ' å…³', 900);
}

/* ---------- render cards ---------- */
function renderCards(cards){
  boardEl.innerHTML = '';
  cards.forEach((c,idx)=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerText = c.text;
    div.dataset.key = c.key;
    div.dataset.idx = idx;
    div.onclick = () => onCardClick(c, div);
    boardEl.appendChild(div);
  });
  leftEl.innerText = document.querySelectorAll('.card').length;
}

/* ---------- card click ---------- */
function onCardClick(card, el){
  if(el.classList.contains('hidden')) return;
  if(!selected){
    selected = { card, el };
    el.classList.add('active');
    return;
  }
  // same element -> toggle off
  if(selected.el === el){
    selected.el.classList.remove('active'); selected = null; return;
  }

  if(selected.card.key === card.key){
    // success: animate hide
    selected.el.classList.add('hidden');
    el.classList.add('hidden');
    // increment score with mode weights
    const weight = MODE === 'battle' ? 10 : (MODE === 'revenge' ? 5 : 1);
    score += weight;
    updateScore();
    // remove nodes after short delay
    setTimeout(()=>{
      try{ if(selected.el.parentNode) selected.el.parentNode.removeChild(selected.el); }catch(e){}
      try{ if(el.parentNode) el.parentNode.removeChild(el); }catch(e){}
      selected = null;
      leftEl.innerText = document.querySelectorAll('.card').length;
      // if was wrongbook pool and matched, remove from wrongBook
      if(MODE === 'revenge'){
        // remove from wrongBook any items with this key
        wrongBook = wrongBook.filter(w => w.en !== card.key);
        saveWrong();
      }
      // win check
      if(document.querySelectorAll('.card').length === 0){
        onLevelComplete();
      }
    },220);
  } else {
    // fail: record wrong in battle mode
    if(MODE === 'battle'){
      const enKey = selected.card.key;
      // retrieve cn via LEVELS mapping or from selected.card/ card
      const raw = findWordByEn(enKey);
      const cnText = raw ? (raw.cn || '') : '';
      if(enKey && !wrongBook.some(w=>w.en === enKey)){
        wrongBook.push({en:enKey, cn:cnText});
        saveWrong();
      }
    }
    // visual feedback
    selected.el.classList.remove('active');
    selected = null;
    showToast('é…å¯¹é”™è¯¯', 700);
  }
}

/* ---------- find original word by english key (in levels or wrong book) ---------- */
function findWordByEn(en){
  // search current LEVELS
  for(const k of Object.keys(LEVELS)){
    const arr = LEVELS[k];
    for(const w of arr){
      if(w.en === en) return w;
    }
  }
  // search wrongBook
  for(const w of wrongBook){
    if(w.en === en) return w;
  }
  return null;
}

/* ---------- on level complete ---------- */
function onLevelComplete(){
  // mark progress
  if(!progress[LIB_NAME]) progress[LIB_NAME] = {};
  progress[LIB_NAME][currentLevelKey] = true;
  saveProgress();
  updateProgressUI();

  // try unlock next
  const idx = LEVEL_KEYS.indexOf(currentLevelKey);
  const nextKey = LEVEL_KEYS[idx+1];
  let msg = 'æœ¬å…³å®Œæˆï¼';
  if(nextKey){
    msg += ' è§£é”ä¸‹ä¸€å…³ï¼š' + nextKey.replace('level','ç¬¬') + ' å…³';
    // auto-select next level for convenience
    currentLevelKey = nextKey;
    levelSelect.value = currentLevelKey;
  } else {
    msg += ' å·²å®Œæˆå½“å‰è¯åº“æ‰€æœ‰å…³å¡ï¼';
  }
  showToast(msg, 1400);
}

/* ---------- share / invite functionality ---------- */
function shareInvite(){
  // create a share link that encodes current settings
  const url = new URL(location.href);
  url.searchParams.set('mode', MODE || 'battle');
  url.searchParams.set('level', currentLevelKey);
  url.searchParams.set('lib', LIB_NAME);
  const shareText = `æˆ‘åœ¨ç© CETæ¶ˆæ¶ˆä¹ï¼Œæ¥æŒ‘æˆ˜æˆ‘ç¬¬ ${currentLevelKey.replace('level','')} å…³å§ï¼\n${url.toString()}`;

  // navigator.share if available
  if(navigator.share){
    navigator.share({ title: 'CETæ¶ˆæ¶ˆä¹æŒ‘æˆ˜', text: shareText, url: url.toString() })
      .catch(()=>{ copyToClipboard(url.toString()); showToast('å·²å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿'); });
  } else {
    copyToClipboard(url.toString());
    showToast('å·²å¤åˆ¶é‚€è¯·é“¾æ¥ï¼ˆç²˜è´´å‘é€ï¼‰',1200);
  }
}

function copyToClipboard(text){
  try{
    const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta);
    ta.select(); document.execCommand('copy'); ta.remove();
  }catch(e){
    // fallback
    alert('åˆ†äº«é“¾æ¥ï¼š ' + text);
  }
}

/* ---------- support invite links on page load ---------- */
function loadQueryParams(){
  const params = new URLSearchParams(location.search);
  const m = params.get('mode');
  const lvl = params.get('level');
  const lib = params.get('lib');
  if(lib && (lib==='cet4' || lib==='cet6')) {
    switchLib(lib);
  }
  if(lvl && LEVEL_KEYS.includes(lvl)) currentLevelKey = lvl;
  if(m && (m==='immerse' || m==='battle' || m==='revenge')){
    chooseMode(m);
  }
  levelSelect.value = currentLevelKey;
}

/* ---------- update score UI ---------- */
function updateScore(){ scoreEl.innerText = score; }

/* ---------- update progress UI (mark unlocked) ---------- */
function updateProgressUI(){
  // ensure progress object structure
  if(!progress[LIB_NAME]) progress[LIB_NAME] = {};
  // reflect unlocked levels in levelSelect (we'll append '*' to unlocked)
  renderLevelOptions(); // refresh keys
  // update options text
  Array.from(levelSelect.options).forEach(opt=>{
    const key = opt.value;
    const unlocked = !!(progress[LIB_NAME] && progress[LIB_NAME][key]);
    opt.innerText = key.replace('level','ç¬¬') + ' å…³' + (unlocked? ' â­' : '');
  });
}

/* ---------- open wrong book viewer ---------- */
function openWrongBook(){
  if(!wrongBook || wrongBook.length===0){
    alert('é”™è¯æœ¬ä¸ºç©º');
    return;
  }
  const text = wrongBook.map((w,i)=>`${i+1}. ${w.en}\t${w.cn||''}`).join('\n');
  // show in prompt style (simple)
  alert('é”™è¯æœ¬:\n\n' + text);
}

/* ---------- helper: change lib option when select updated ---------- */
function renderLevelOptions(){
  // preserve current selected value if same lib
  const prev = levelSelect.value;
  levelSelect.innerHTML = '';
  LEVEL_KEYS = Object.keys(LEVELS);
  LEVEL_KEYS.forEach(k=>{
    const opt = document.createElement('option');
    opt.value = k;
    opt.innerText = k.replace('level','ç¬¬') + ' å…³';
    levelSelect.appendChild(opt);
  });
  // set value
  if(LEVEL_KEYS.includes(prev)) levelSelect.value = prev;
  else levelSelect.value = LEVEL_KEYS[0] || '';
}

/* ---------- initialize progress structure if empty ---------- */
if(!progress.cet4) progress.cet4 = {};
if(!progress.cet6) progress.cet6 = {};
saveProgress();

/* ---------- expose some functions for console debugging (optional) ---------- */
window._CET = {
  switchLib, chooseMode, startLevel, startGame:startLevel, openWrongBook, exportWrong: ()=>{ alert('å¯¼å‡ºåŠŸèƒ½åœ¨æ­¤æ¼”ç¤ºï¼Œéœ€è¦è‡ªè¡Œå®ç°'); }
};

</script>
</body>
</html>
